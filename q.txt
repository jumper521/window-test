import boto3

elbv2_client = boto3.client('elbv2')
ec2_client = boto3.client('ec2')

def lambda_handler(event, context):
    # ターゲットグループのARNを指定
    target_group_arn = 'arn:aws:elasticloadbalancing:REGION:ACCOUNT_ID:targetgroup/TARGETGROUP_NAME/1234567890abcdef0'

    # ターゲットグループから全てのターゲットを解除
    targets = elbv2_client.describe_target_health(TargetGroupArn=target_group_arn)
    for target in targets['TargetHealthDescriptions']:
        elbv2_client.deregister_targets(TargetGroupArn=target_group_arn, Targets=[{'Id': target['Target']['Id']}])

    # 新しいEC2インスタンスを取得し、そのインスタンスIDをリストに追加
    new_instance_ids = ['i-NEW_INSTANCE_ID_1', 'i-NEW_INSTANCE_ID_2']  # 新しいEC2インスタンスのIDを指定

    # 新しいEC2インスタンスをターゲットグループに登録
    elbv2_client.register_targets(TargetGroupArn=target_group_arn, Targets=[{'Id': instance_id} for instance_id in new_instance_ids])

    return {
        'statusCode': 200,
        'body': '新しいEC2インスタンスがターゲットグループに登録されました。'
    }
